# ansible-server-hardening

Complementary repository to blog post at https://able.bio/jibiabraham/basic-server-hardening-using-ansible

Instructions on how to use this repository.

## Prerequisites

Ensure that you have ansible installed. Highly recommended that you install ansible inside a virtualenv.

Resources:

1. [Setup Ansible with Python Virtualenv](https://buildahomelab.com/2018/10/06/setup-ansible-with-virtualenv/)

## Steps to run the ansible playbook

1. Edit the `hosts` file to include ip addresses of all your instances
2. Within `./roles/harden/tasks/main.yml`, set the hashed password for the `deploy user`
3. Within `./roles/harden/tasks/main.yml`, set the proper path to your public SSH key, under the task named `Set authorized key taken from file`
4. From the root of the project, run `ansible-playbook -i hosts harden_instances.yml`

Note: all the commands are run as root user.

## FAQ

### How do I use the key-pair generated by AWS, on launching the instance, to login to the machine using ansible

In your hosts file, specify the path to the private key file you downloaded from AWS.
Assuming the default login user is `ubuntu` (which for AWS is the case)

```
<ip_address> ansible_user=ubuntu ansible_ssh_private_key_file=/home/<...>.private_key.pem
```

### How do I create a hashed password for the `deploy` user

You can use the `mkpasswd` utility in Ubuntu for the same.

You will be prompted to enter a new password. Once you hit return, the hash for the password you entered will be printed on screen.

```
mkpasswd --method=SHA-512 --stdin
```
